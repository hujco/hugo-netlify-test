<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>OAuth Debugging</title>
</head>
<body>
OAuth Debug – OKNO SA TERAZ NEZATVORÍ, kontrolujeme token.<br>
Otvor teraz DEVTOOLS (F12), pozri Network a Console.<br>
Token nájdeš nižšie (v konzole aj na stránke).

<script>
    const hash = window.location.hash;
    const tokenInfo = document.createElement("div");
    tokenInfo.innerText = `Token prijatý: ${hash}`;
    tokenInfo.style.color = "green";
    tokenInfo.style.padding = "10px";
    tokenInfo.style.marginTop = "20px";
    document.body.appendChild(tokenInfo);

    console.log("[OAuth debug] hash prijatý: ", hash);

    if(window.opener) {
        console.log("[OAuth debug] Zistil som opener - pokus poslat spravu");
        try {
            window.opener.postMessage(hash, window.location.origin);
            console.log("[OAuth debug] Správa úspešne odoslaná opener.");
        } catch(err) {
            console.error("[OAuth debug] Chyba pri postMessage: ", err);
        }
        console.log("[OAuth debug] DEBUG mod - Popup sa teraz NEZATVÁRA.");
        //window.close();  // zatváranie vypnuté pre debugging!
    } else {
        console.warn("[OAuth debug] window.opener NIE JE dostupný !");
        console.log("[OAuth debug] Toto nie je popup. Toto okno sa teraz nezavrie.");
    }
</script>
</body>
</html>
