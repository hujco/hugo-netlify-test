name: 🚀 Deploy Hugo site via SSH

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ✅ Checkout repository
        uses: actions/checkout@v4

      - name: 🛠️ Install Hugo CLI
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.124.1'
          extended: true

      - name: 🔨 Build Hugo site
        run: hugo --minify

      - name: 📂 Check public/ exists
        run: ls -lah public || echo "⚠️ Priečinok public NEEXISTUJE!"

      - name: 🔐 Over priečinok na serveri
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 28144
          script: |
            echo ">> Obsah ~/tomashujcak.sk/web:"
            ls -lah ~/tomashujcak.sk/web || echo "❌ Cieľ neexistuje"

      - name: 🚀 Deploy Hugo cez rsync
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 28144
          script: |
            echo ">> Deployujem..."
            rsync -avz --delete public/ ~/tomashujcak.sk/web/
