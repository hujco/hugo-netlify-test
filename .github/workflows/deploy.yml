name: ğŸš€ Deploy Hugo site via SSH

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Install Hugo CLI
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.124.1'
          extended: true

      - name: ğŸ”¨ Build Hugo site
        run: hugo --minify --verbose

      - name: ğŸ“‚ Skontroluj obsah public/ prieÄinka
        run: |
          echo "ğŸ“ AktuÃ¡lny prieÄinok:"
          pwd
          echo "ğŸ“‚ Obsah public/:"
          ls -lah public || echo "âš ï¸ PrieÄinok public NEEXISTUJE! Hugo build zlyhal alebo vygeneroval prÃ¡zdny adresÃ¡r."

      - name: ğŸ” Over cieÄ¾ovÃ½ prieÄinok na serveri
        uses: appleboy/ssh-action@v1.2.2
        with:
          host: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 28144
          script: |
            echo "ğŸ“ Kontrolujem prieÄinok na serveri ~/tomashujcak.sk/web:"
            ls -lah ~/tomashujcak.sk/web || echo "âŒ CieÄ¾ na serveri neexistuje!"

      - name: ğŸš€ Deploy cez rsync s explicitnÃ½mi cestami
        uses: burnett01/rsync-deployments@latest
        with:
          switches: -avz --delete
          path: public/
          remote_path: ~/tomashujcak.sk/web/
          remote_host: ${{ secrets.FTP_HOST }}
          remote_user: ${{ secrets.FTP_USER }}
          remote_port: 28144
          remote_key: ${{ secrets.SSH_PRIVATE_KEY }}
