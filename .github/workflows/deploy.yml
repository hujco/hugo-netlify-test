name: üêõ Debug Hugo Deploy

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ‚úÖ Checkout repository
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Build Hugo site with Docker
        run: |
          echo ">> Sp√∫≈°≈•am Hugo build"
          docker run --rm \
            -v ${{ github.workspace }}:/src \
            -w /src \
            klakegg/hugo:ext-alpine \
            --minify
          echo "‚úÖ Hugo build hotov√Ω"

      - name: üìÇ Skontroluj obsah prieƒçinku public/
        run: |
          echo ">> Obsah prieƒçinka ./public:"
          ls -lah public || echo "‚ö†Ô∏è Prieƒçinok public NEEXISTUJE!"

      - name: üîê Pripoj sa cez SSH a over existenciu cieƒæovej zlo≈æky
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 28144
          script: |
            echo ">> Aktu√°lny prieƒçinok:"
            pwd
            echo ">> Obsah ~/tomashujcak.sk/web:"
            ls -lah ~/tomashujcak.sk/web || echo "‚ùå Cesta neexistuje"

      - name: üöÄ Deploy Hugo cez rsync
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 28144
          script: |
            echo ">> Deployujem public/ na server..."
            rsync -avz --delete public/ ~/tomashujcak.sk/web/ || echo "‚ùå RSYNC zlyhal!"
